<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<head>

  <metal:block metal:fill-slot="head_slot">
  <style type="text/css" 
         media="all"
         tal:content=
          "string: @import url(${context/++resource++p4acalendar/calendar.css});">
  </style>
  <script type="text/javascript" src="calendar.js"
          tal:attributes="src string:${context/++resource++p4acalendar/anchor-position.js}">
  </script>
  <script type="text/javascript" src="calendar.js"
          tal:attributes="src string:${context/++resource++p4acalendar/popup-window.js}">
  </script>
  <script type="text/javascript" src="calendar.js"
          tal:attributes="src string:${context/++resource++p4acalendar/calendar.js}">
  </script>
  </metal:block>
  
</head>

<body>

<div metal:fill-slot="main"
     class="p4acalendar">
            
  <tal:block tal:repeat="day view/alldays">
     <div id=""
          style="visibility:hidden"
          class="day-event-popup"
          tal:condition="day/allevents"
          tal:attributes="id string:p4acalendar-allevents-${day/datestr}">

       <ul>
         <li tal:repeat="event day/events">
           <dl>
             <dt>
               <a href=""
                  tal:content="event/title"
                  tal:attributes="href event/local_url"></a>
             </dt>
             <dd tal:content="event/timespan"></dd>
             <dd tal:content="event/description"></dd>
         </li>
       </ul>
     </div>
  </tal:block>

  <div class="month"
       tal:define="icalview nocall:context/@@icalendar.ics">
    <span style="float:right">
      <a href="icalendar.ics" tal:condition="icalview/has_ical_support">
         <img tal:attributes="src string:${portal_url}/icon_export_ical.png"/> Export
      </a>
    </span>
    <h1>
      <a href=""
         class="previous"
         tal:attributes="href view/prev_month_link">&larr;</a>
      <span tal:replace="view/month"></span> <span tal:replace="view/year"></span>
      <a href=""
         class="next"
         tal:attributes="href view/next_month_link">&rarr;</a>
    </h1>

    <tal:block replace="structure view/render_filter"/>
    <tal:block define="link view/event_creation_link" condition="python:link">
       <a tal:attributes="href link">Create event</a> | </tal:block>
    View: <a class="view_link" href="events.html">Event list</a> |
    <a class="view_link" href="past_events.html">Past events list</a>
    
    <div class="standard-week-days">
      <tal:block tal:repeat="day view/standard_week_days">
      <div tal:attributes="class string:day ${day/extrastyleclass}"
           tal:content="day/day"></div>
      </tal:block>
      <div class="visualClear"></div>
    </div>

    <div tal:repeat="week view/weeks"
         class="week"
         tal:attributes="class string:week ${week/extrastyleclass}">
         
       <div tal:repeat="day week/days"
            tal:attributes="class string:day ${day/extrastyleclass};
                            id string:p4acalendar-day-${day/datestr}"
            class="day"
            id="">
            
            <tal:block tal:define="extra python:len(day['allevents']) - len(day['events'])">
            
            <dl>
              <dt tal:condition="day/day">
                <a href=""
                   tal:content="day/day"
                   tal:attributes="onclick string:events_popup('${day/datestr}');;return false;;"></a>
              </dt>
              <dt tal:condition="not:day/day">&nbsp;</dt>
              <tal:block repeat="event day/events">
                <dd tal:attributes="class event/type">
                  <a class="event-title" 
                     tal:content="event/label"
                     tal:attributes="href event/local_url;
                                     title event/description"></a>
                </dd>
              </tal:block>
              <dd tal:condition="extra" class="extra-events">
                <a href=""
                   tal:attributes="onclick string:events_popup('${day/datestr}');;return false;;">
                  +<span tal:replace="extra"></span>
                </a>
              </dd>
            </dl>

            </tal:block>
       </div>
       <div class="visualClear"></div>
    </div>
    <div class="visualClear"></div>
  </div>

</div> <!-- end main fill slot -->

</body>
</html>
